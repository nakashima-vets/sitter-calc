<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>ペットシッター 計算シミュレーター</title>

<style>
body{
  font-family:system-ui,-apple-system,"Noto Sans JP",sans-serif;
  margin:14px;max-width:760px;
}
body.mode-sitter{background:#fff}
body.mode-nurse{background:#f4f9ff}

h1{font-size:18px;margin:6px 0 12px}

.tabs{display:flex;gap:8px;margin-bottom:12px}
.tab{
  padding:10px 14px;border:1px solid #ccc;border-radius:999px;
  background:#fff;font-weight:700;cursor:pointer
}
.tab.active{background:#111;color:#fff;border-color:#111}

.card{
  border:1px solid #e5e5e5;border-radius:16px;
  padding:14px;margin:12px 0
}

label{font-size:12px;margin-top:10px;display:block}
select,input:not([type=checkbox]){
  width:100%;padding:10px;border-radius:12px;border:1px solid #ccc
}

.row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
.grid4{display:grid;grid-template-columns:1fr 1fr;gap:12px}
@media(min-width:640px){
  .grid4{grid-template-columns:1fr 1fr 1fr 1fr}
}

.checks{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-top:10px}
.checks label{display:flex;gap:8px;align-items:flex-start;font-size:13px}

.total{font-size:26px;font-weight:900;margin:8px 0}
.list{font-size:13px;line-height:1.7}
pre{
  background:#fafafa;border:1px solid #eee;
  border-radius:12px;padding:10px;font-size:12px
}
button{
  padding:10px 14px;border-radius:12px;border:0;
  background:#111;color:#fff;font-weight:800;cursor:pointer
}
button.secondary{background:#eee;color:#111}

#copyArea{display:none;}
</style>
</head>

<body class="mode-sitter">

<h1>ペットシッター 計算シミュレーター</h1>

<div class="tabs">
  <button class="tab active" id="tab-sitter" onclick="setService('sitter')">ペットシッター</button>
  <button class="tab" id="tab-nurse" onclick="setService('nurse')">動物看護師</button>
</div>

<div class="card">
<div id="serviceLabel">サービス：ペットシッター</div>

<div class="checks">
  <label><input type="checkbox" id="patient"> 当院患者</label>
  <label><input type="checkbox" id="review"> レビューキャンペーン</label>
</div>

<label>サービス回数</label>
<select id="visits"></select>

<label>頭数</label>
<div class="grid4">
  <div><label>猫</label><select id="cat"></select></div>
  <div><label>小型犬</label><select id="small"></select></div>
  <div><label>中型犬</label><select id="medium"></select></div>
  <div><label>大型犬</label><select id="large"></select></div>
</div>

<div class="row" style="margin-top:10px">
  <div>
    <label>時間延長</label>
    <select id="ext">
      <option value="0">なし</option>
      <option value="1">15分</option>
      <option value="2">30分</option>
      <option value="3">45分</option>
      <option value="4">60分</option>
    </select>
  </div>
  <div>
    <label>有料駐車場（円/回）</label>
    <input id="parking" type="number" min="0" value="0">
  </div>
</div>

<div class="row" style="margin-top:10px">
  <div>
    <label>鍵返却</label>
    <select id="keyReturn">
      <option value="0">受付返却</option>
      <option value="500">こねこ便</option>
      <option value="800">簡易書留</option>
    </select>
  </div>
  <div>
    <label><input type="checkbox" id="busy"> 緊忙期（+20%）</label>
  </div>
</div>

<div style="margin-top:12px">
  <button onclick="calc()">計算</button>
  <button class="secondary" onclick="copyResult()">コピー</button>
</div>
</div>

<div class="card">
<div class="total" id="total">¥0</div>
<div class="list" id="breakdown"></div>
<pre id="copyArea"></pre>
</div>

<script>
const MASTER={
  dispatch:1100,busy:0.2,review:0.2,
  sitter:{
    label:"ペットシッター",
    ext:1100,patient:200,
    plan:{cat:[4400,1100],small:[5000,2500],medium:[5300,2650],large:[5900,2950]}
  },
  nurse:{
    label:"愛玩動物看護師ペットシッター",
    ext:1400,patient:300,
    plan:{cat:[5500,1400],small:[6100,3000],medium:[6400,3200],large:[7000,3500]}
  }
};

let current="sitter";
const yen=n=>"¥"+Math.round(n).toLocaleString("ja-JP");

function fill(id){
  const s=document.getElementById(id);
  for(let i=0;i<=10;i++){
    const o=document.createElement("option");
    o.value=i;o.textContent=i;s.appendChild(o);
  }
}
["visits","cat","small","medium","large"].forEach(fill);

function setService(s){
  current=s;
  document.body.className=s==="sitter"?"mode-sitter":"mode-nurse";
  document.getElementById("tab-sitter").classList.toggle("active",s==="sitter");
  document.getElementById("tab-nurse").classList.toggle("active",s==="nurse");
  document.getElementById("serviceLabel").textContent="サービス："+MASTER[s].label;
  calc();
}

function calc(){
  const v = +visits.value;

  // 回数0は初期状態（0円・明細なし）
  if(v===0){
    total.textContent="¥0";
    breakdown.innerHTML="";
    copyArea.textContent="";
    return;
  }

  const svc = MASTER[current];

  const heads = {
    cat:+cat.value, small:+small.value, medium:+medium.value, large:+large.value
  };

  const NAME = {cat:"猫", small:"小型犬", medium:"中型犬", large:"大型犬"};

  // 基準（baseが最大の種別）
  let basePrice = 0, baseKey = "";
  for(const k of Object.keys(heads)){
    if(heads[k]>0 && svc.plan[k][0] > basePrice){
      basePrice = svc.plan[k][0];
      baseKey = k;
    }
  }

  // 頭数が全部0
  if(basePrice===0){
    total.textContent="¥0";
    breakdown.innerHTML="・頭数を入力してください（猫/小型/中型/大型）";
    copyArea.textContent="";
    return;
  }

  // 追加計算（基準種別は1頭分を基準に回す）
  let addTotal = 0;
  const addLines = [];
  for(const k of Object.keys(heads)){
    const n = heads[k];
    if(n<=0) continue;
    const addUnit = svc.plan[k][1];
    const reduce = (k===baseKey) ? 1 : 0;
    const addN = Math.max(0, n - reduce);
    if(addN>0){
      const amt = addUnit * addN;
      addTotal += amt;
      addLines.push(`　- 追加：${NAME[k]} ${addN}頭（${yen(addUnit)}×${addN} = ${yen(amt)}）`);
    }
  }

  const plan1 = basePrice + addTotal;     // 1回あたり（基準+追加）
  const planTotal = plan1 * v;            // 回数分

  // 調整（プランのみ）
  const busyAdd = busy.checked ? planTotal * MASTER.busy : 0;
  const planAfterBusy = planTotal + busyAdd;

  const reviewDiscount = review.checked ? planAfterBusy * MASTER.review : 0;
  const patientDiscount = (patient.checked && !review.checked) ? svc.patient * v : 0;

  const planFinal = planAfterBusy - reviewDiscount - patientDiscount;

  // そのほか
  const dispatchTotal = MASTER.dispatch * v;

  const extCount = +ext.value; // 0-4
  const extTotal = extCount>0 ? svc.ext * extCount * v : 0;

  const park = +parking.value || 0;
  const parkingTotal = park>0 ? park * v : 0;

  const key = +keyReturn.value || 0; // 0/500/800（1回だけ）
  const keyTotal = key>0 ? key : 0;

  const grandTotal = planFinal + dispatchTotal + extTotal + parkingTotal + keyTotal;
  total.textContent = yen(grandTotal);

  // ===== 表示（0や対象外は出さない）=====
  const headText = Object.keys(heads)
    .filter(k=>heads[k]>0)
    .map(k=>`${NAME[k]}${heads[k]}`)
    .join(" / ");

  const lines = [];
  lines.push(`・サービス：${svc.label}`);
  lines.push(`・回数：${v}回`);
  if(headText) lines.push(`・頭数：${headText}`);

  lines.push(`・<strong>プラン（1回あたり）：${yen(plan1)}</strong>（基準：${NAME[baseKey]} 1頭 ${yen(basePrice)}）`);
  addLines.forEach(x=>lines.push(x));
  lines.push(`・プラン合計：${yen(planTotal)}（${v}回）`);

  if(busyAdd>0) lines.push(`・緊忙期 +20%（プランのみ）：+${yen(busyAdd)}`);
  if(reviewDiscount>0) lines.push(`・レビュー -20%（プランのみ）：-${yen(reviewDiscount)}`);
  if(patientDiscount>0) lines.push(`・当院患者割：-${yen(patientDiscount)}`);

  lines.push(`・プラン小計：${yen(planFinal)}`);

  if(dispatchTotal>0) lines.push(`・出張費：${yen(dispatchTotal)}（${yen(MASTER.dispatch)}/回×${v}回）`);
  if(extTotal>0) lines.push(`・時間延長：${yen(extTotal)}（${yen(svc.ext)}/15分×${extCount}回×${v}回）`);
  if(parkingTotal>0) lines.push(`・有料駐車場：${yen(parkingTotal)}（${yen(park)}/回×${v}回）`);
  if(keyTotal>0) lines.push(`・鍵返却：${yen(keyTotal)}（1回）`);

  lines.push(`・<strong>合計（税込）：${yen(grandTotal)}</strong>`);

  breakdown.innerHTML = lines.join("<br>");

  // ===== コピー文（必要ならここも詳細に）=====
  const minutes = extCount * 15;
  copyArea.textContent =
`【仮見積（税込）】
サービス：${svc.label}
回数：${v}回
頭数：${headText || "（未入力）"}
基準：${NAME[baseKey]}
プラン（1回あたり）：${yen(plan1)}
プラン合計：${yen(planTotal)}
${busyAdd>0 ? `緊忙期：+${yen(busyAdd)}\n` : ""}${reviewDiscount>0 ? `レビュー：-${yen(reviewDiscount)}\n` : ""}${patientDiscount>0 ? `当院患者割：-${yen(patientDiscount)}\n` : ""}
プラン小計：${yen(planFinal)}
出張費：${yen(dispatchTotal)}
${extTotal>0 ? `延長：${minutes}分（${yen(extTotal)}）\n` : ""}${parkingTotal>0 ? `駐車場：${yen(parkingTotal)}\n` : ""}${keyTotal>0 ? `鍵返却：${yen(keyTotal)}\n` : ""}
合計：${yen(grandTotal)}

※最終金額は事前カウンセリング後に確定します。`;
}

function copyResult(){
  const text = document.getElementById("breakdown").innerText.trim();
  if(!text){
    alert("コピーする内容がありません");
    return;
  }
  navigator.clipboard.writeText(text);
  alert("コピーしました");
}
</script>
</body>
</html>
