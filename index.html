<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>ペットシッター 計算シミュレーター</title>

<style>
*,*::before,*::after{box-sizing:border-box;}
body{
  font-family:system-ui,-apple-system,"Noto Sans JP",sans-serif;
  margin:14px;max-width:760px;
}
body.mode-sitter{background:#fff}
body.mode-nurse{background:#f4f9ff}

h1{font-size:18px;margin:6px 0 12px}

.tabs{display:flex;gap:8px;margin-bottom:12px}
.tab{
  padding:10px 14px;border:1px solid #ccc;border-radius:999px;
  background:#fff;font-weight:700;cursor:pointer
}
.tab.active{background:#111;color:#fff;border-color:#111}

.card{
  border:1px solid #e5e5e5;border-radius:16px;
  padding:14px;margin:12px 0
}

label{font-size:12px;margin-top:10px;display:block}
select,input:not([type=checkbox]){
  width:100%;padding:10px;border-radius:12px;border:1px solid #ccc
}

.labelStrong{font-weight:900;}
input.compact-input,select.compact-input{padding:8px 10px;border-radius:10px;}
input.narrow,select.narrow{max-width:220px;}
.parking-row{display:flex;gap:8px;align-items:center}
.parking-row .parking-select{flex:0 0 120px;max-width:140px}
.parking-row .parking-other{flex:1 1 auto;min-width:120px}
@media(min-width:640px){input.narrow{max-width:260px;}}

.row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
.grid4{display:grid;grid-template-columns:1fr 1fr;gap:12px}
@media(min-width:640px){
  .grid4{grid-template-columns:1fr 1fr 1fr 1fr}
}

.checks{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-top:10px}
.checks label{display:flex;gap:8px;align-items:flex-start;font-size:13px}

.total{font-size:26px;font-weight:900;margin:8px 0}
.list{font-size:13px;line-height:1.7}
pre{
  background:#fafafa;border:1px solid #eee;
  border-radius:12px;padding:10px;font-size:12px
}
button{
  padding:10px 14px;border-radius:12px;border:0;
  background:#111;color:#fff;font-weight:800;cursor:pointer
}
button.secondary{background:#eee;color:#111}


.table-wrap{overflow-x:auto;border-radius:12px;border:1px solid #eee}
.scroll-hint{display:none;font-size:12px;color:#666;margin:6px 2px}
@media(max-width:560px){.scroll-hint{display:block}}

.result-bar{display:flex;justify-content:space-between;gap:12px;align-items:flex-start;margin-bottom:10px}
.meta{font-size:12px;color:#444;font-weight:700}
.msg{font-size:12px;color:#b00;margin-top:4px}
@media(max-width:560px){.result-bar{flex-direction:column}.total{font-size:22px}}

.estimate-table{
  width:100%;
  border-collapse:collapse;
  background:#fff;
  min-width:520px;
}
.estimate-table th,.estimate-table td{border:1px solid #ddd;padding:10px;vertical-align:top}
.estimate-table th{background:#f4f6f8;font-weight:900;text-align:left}
.estimate-table th.num,.estimate-table td.num{text-align:right;white-space:nowrap;min-width:92px}

 /* 項目列は固定（数値だけ横スクロール） */
.estimate-table th:first-child,
.estimate-table td:first-child{
  position:sticky;
  left:0;
  z-index:2;
  background:#fff;
  min-width:220px;
  max-width:320px;
}
.estimate-table thead th:first-child{z-index:3;background:#f4f6f8;}

.estimate-table tr.section td{background:#f7fbff;font-weight:900;position:static !important}
.estimate-table tr.discount td{color:#c00;font-weight:900}
.estimate-table tr.surcharge td{color:#0a6;font-weight:900}
.estimate-table tr.subtot td{font-weight:900}
.estimate-table tfoot td{background:#111;color:#fff;font-weight:900;position:static !important}
.estimate-table tfoot td.num{font-size:16px}
.estimate-table .muted{color:#666;font-weight:600}

@media (max-width:520px){
  .scroll-hint{display:block}
  .estimate-table{font-size:11px;min-width:480px}
  .estimate-table th,.estimate-table td{padding:7px}
  .estimate-table th.num,.estimate-table td.num{min-width:84px}
  .estimate-table tfoot td.num{font-size:13px}
  .estimate-table th:first-child,.estimate-table td:first-child{min-width:200px}
}


.form-section{margin-top:14px}
.sectionTitle{
  display:flex;align-items:center;gap:10px;
  font-weight:900;font-size:13px;
  padding:0;margin:10px 2px 8px;
  background:transparent;border:none;color:#5a4300;
}
.sectionTitle::before{
  content:"";width:10px;height:10px;border-radius:3px;
  background:#ffd978;flex:0 0 auto;
}
.sectionTitle::after{
  content:"";height:1px;background:#ffe3a1;flex:1;
}
.sectionTitle.discount{color:#7a1e1e;}
.sectionTitle.discount::before{background:#ffb3b3;}
.sectionTitle.discount::after{background:#ffcccc;}
.subTitle{font-weight:900;font-size:13px;color:#333;margin:10px 2px 6px}
.heads{display:grid;grid-template-columns:1fr;gap:10px}
@media(min-width:640px){.heads{grid-template-columns:1fr 1fr;gap:12px}}
.field label{margin-top:0}
.checkbox-line{display:flex;gap:10px;align-items:flex-start;font-size:13px;margin-top:10px}
.checkbox-line input{margin-top:2px}

#copyArea{display:none;}
</style>
</head>

<body class="mode-sitter">

<h1>ペットシッター 計算シミュレーター</h1>

<div class="tabs">
  <button class="tab active" id="tab-sitter" onclick="setService('sitter')">ペットシッター</button>
  <button class="tab" id="tab-nurse" onclick="setService('nurse')">動物看護師</button>
</div>

<div class="card">
<div id="serviceLabel">サービス：ペットシッター</div>

<div class="form-section">
  <div class="sectionTitle">★カウンセリング</div>
  <label class="checkbox-line labelStrong"><input type="checkbox" id="counseling"> 初回カウンセリング費（+2,500円／1回）</label>

  <label class="labelStrong">有料駐車場（カウンセリング／円）</label>
  <div class="parking-row">
    <select id="parkingCounselSel" class="compact-input narrow parking-select" aria-label="駐車場（カウンセリング）">
      <option value="0">0</option>
      <option value="100">100</option>
      <option value="200">200</option>
      <option value="300">300</option>
      <option value="400">400</option>
      <option value="500">500</option>
      <option value="other">その他</option>
    </select>
    <input id="parkingCounselOther" class="compact-input narrow parking-other" type="number" min="0" value="0" placeholder="その他（円）" style="display:none">
  </div>
</div>

<div class="form-section">
  <div class="sectionTitle">★シッティング</div>

  <label class="labelStrong">サービス回数</label>
  <select id="visits"></select>

  <div class="subTitle labelStrong">頭数</div>
  <div class="heads">
    <div class="field"><label class="labelStrong">猫</label><select id="cat"></select></div>
    <div class="field"><label class="labelStrong">小型犬</label><select id="small"></select></div>
    <div class="field"><label class="labelStrong">中型犬</label><select id="medium"></select></div>
    <div class="field"><label class="labelStrong">大型犬</label><select id="large"></select></div>
  </div>

  <label class="labelStrong">有料駐車場（シッティング／円/回）</label>
  <div class="parking-row">
    <select id="parkingVisitSel" class="compact-input narrow parking-select" aria-label="駐車場（シッティング）">
      <option value="0">0</option>
      <option value="100">100</option>
      <option value="200">200</option>
      <option value="300">300</option>
      <option value="400">400</option>
      <option value="500">500</option>
      <option value="other">その他</option>
    </select>
    <input id="parkingVisitOther" class="compact-input narrow parking-other" type="number" min="0" value="0" placeholder="その他（円）" style="display:none">
  </div>
</div>

<div class="form-section">
  <div class="sectionTitle discount">★割引</div>
  <label class="checkbox-line labelStrong"><input type="checkbox" id="review"> レビューキャンペーン（プラン -20%）</label>
</div>

<div class="form-section">
  <div class="sectionTitle">★オプション</div>

  <label class="labelStrong">鍵返却</label>
  <select id="keyReturn">
    <option value="0">受付返却</option>
    <option value="500">こねこ便</option>
    <option value="800">簡易書留</option>
  </select>

  <label class="labelStrong">時間延長</label>
  <select id="ext">
    <option value="0">なし</option>
    <option value="1">15分</option>
    <option value="2">30分</option>
    <option value="3">45分</option>
    <option value="4">60分</option>
  </select>

  <label class="checkbox-line labelStrong"><input type="checkbox" id="busy"> 緊忙期（プラン +20%）</label>
  <label class="checkbox-line labelStrong"><input type="checkbox" id="afterHours"> 時間外料金（20:00-8:00 / プラン +20%）</label>
</div>

<div style="margin-top:12px">
  <button onclick="copyResult()">コピー</button>
</div>
</div>


<div class="card">

  <div class="result-bar">
    <div>
      <div class="meta" id="resultMeta">—</div>
      <div class="msg" id="resultMessage"></div>
    </div>
    <div class="total" id="total">¥0</div>
  </div>

  <div class="scroll-hint">※横にスクロールできます</div>
  <div class="table-wrap">
    <table class="estimate-table" aria-label="お見積り">
      <thead>
        <tr>
          <th>項目</th>
          <th class="num">単価</th>
          <th class="num">回</th>
          <th class="num">小計</th>
        </tr>
      </thead>
      <tbody id="estimateBody"></tbody>
      <tfoot>
        <tr>
          <td colspan="3">合計金額（税込）</td>
          <td class="num" id="grandTotalCell">0</td>
        </tr>
      </tfoot>
    </table>
  </div>

  <pre id="copyArea"></pre>
</div>

<script>
const MASTER={
  dispatch:1100,
  counseling:2500,
  busy:0.2,
  afterHours:0.2,
  review:0.2,
  sitter:{
    label:"ペットシッター",
    ext:1100,
    plan:{cat:[4400,1100],small:[5000,2500],medium:[5300,2650],large:[5900,2950]}
  },
  nurse:{
    label:"愛玩動物看護師ペットシッター",
    ext:1400,
    plan:{cat:[5500,1400],small:[6100,3000],medium:[6400,3200],large:[7000,3500]}
  }
};

let current="sitter";
const yen=n=>"¥"+Math.round(n).toLocaleString("ja-JP");

function fill(id){
  const s=document.getElementById(id);
  for(let i=0;i<=10;i++){
    const o=document.createElement("option");
    o.value=i;o.textContent=i;s.appendChild(o);
  }
}
["visits","cat","small","medium","large"].forEach(fill);

function setService(s){
  current=s;
  document.body.className=s==="sitter"?"mode-sitter":"mode-nurse";
  document.getElementById("tab-sitter").classList.toggle("active",s==="sitter");
  document.getElementById("tab-nurse").classList.toggle("active",s==="nurse");
  document.getElementById("serviceLabel").textContent="サービス："+MASTER[s].label;
  calc();
}

// 入力を変えたら自動で再計算（計算ボタン不要）
function enableAutoCalc(){
  const ids = ["counseling","review","visits","cat","small","medium","large","ext","parkingCounselSel","parkingCounselOther","parkingVisitSel","parkingVisitOther","keyReturn","busy","afterHours"];
  ids.forEach(id=>{
    const el = document.getElementById(id);
    if(!el) return;
    el.addEventListener("change", calc);
    el.addEventListener("input", calc);
  });
}


function parkingValue(selId, otherId){
  const sel = document.getElementById(selId);
  const other = document.getElementById(otherId);
  if(!sel) return 0;
  const isOther = sel.value === "other";
  if(other) other.style.display = isOther ? "block" : "none";
  if(isOther){
    return +(other && other.value) || 0;
  }
  return +sel.value || 0;
}

function calc(){
  const v = +visits.value;
  const svc = MASTER[current];

  const NAME = {cat:"猫", small:"小型犬", medium:"中型犬", large:"大型犬"};
  const num = n => Math.round(n).toLocaleString("ja-JP");
  const money = n => "¥"+Math.round(n).toLocaleString("ja-JP");
  const setMeta = (text) => { resultMeta.textContent = text; };
  const setMsg = (text) => { resultMessage.textContent = text || ""; };
  const clearTable = () => { estimateBody.innerHTML = ""; };

  // 行追加ヘルパー
  const rows = [];
  const addSection = (title)=> rows.push({type:"section", title});
  const addItem = (item, unit, qty, sub, cls)=> rows.push({type:"item", item, unit, qty, sub, cls});
  const esc = (s)=> String(s).replace(/[&<>"']/g, c=>({ "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;" }[c]));

  const counselingTotal = counseling.checked ? MASTER.counseling : 0;

  // 表示初期化
  setMsg("");
  clearTable();

  // まずメタ
  setMeta(`サービス：${svc.label} / 回数：${v}回`);

  // 回数0：初回カウンセリングのみOK
  if(v===0){
    const parkCounsel = parkingValue("parkingCounselSel","parkingCounselOther");
    const parkingCounselTotal = (counseling.checked && parkCounsel>0) ? parkCounsel : 0;

    let grand = counselingTotal + parkingCounselTotal;
    total.textContent = money(grand);
    grandTotalCell.textContent = num(grand);

    if(counselingTotal>0){
      addSection("初回カウンセリング");
      addItem("初回カウンセリング費", num(MASTER.counseling), "1", num(MASTER.counseling));
      if(parkingCounselTotal>0){
        addItem("駐車場（初回）", num(parkCounsel), "1", num(parkingCounselTotal));
      }
    }else{
      setMsg("回数と頭数を入力すると、見積が表示されます。");
    }

    renderEstimate(rows, grand);
    copyArea.textContent = buildCopyText(rows, grand);
    return;
  }

  // 頭数
  const heads = { cat:+cat.value, small:+small.value, medium:+medium.value, large:+large.value };

  // 基準（baseが最大の種別）
  let basePrice = 0, baseKey = "";
  for(const k of Object.keys(heads)){
    if(heads[k]>0 && svc.plan[k][0] > basePrice){
      basePrice = svc.plan[k][0];
      baseKey = k;
    }
  }

  // 頭数が全部0：初回カウンセリングのみOK
  if(basePrice===0){
    const parkCounsel = parkingValue("parkingCounselSel","parkingCounselOther");
    const parkingCounselTotal = (counseling.checked && parkCounsel>0) ? parkCounsel : 0;

    let grand = counselingTotal + parkingCounselTotal;
    total.textContent = money(grand);
    grandTotalCell.textContent = num(grand);

    if(counselingTotal>0){
      addSection("初回カウンセリング");
      addItem("初回カウンセリング費", num(MASTER.counseling), "1", num(MASTER.counseling));
      if(parkingCounselTotal>0){
        addItem("駐車場（初回）", num(parkCounsel), "1", num(parkingCounselTotal));
      }
    }
    addItem("頭数を入力してください（猫/小型犬/中型犬/大型犬）", "", "", "", "muted-row");
    setMsg("頭数が未入力です。");

    renderEstimate(rows, grand);
    copyArea.textContent = buildCopyText(rows, grand);
    return;
  }

  // ===== プラン（メイン + ペット追加）=====
  const baseSub = basePrice * v;

  // 追加（基準種別は1頭分を基準に回す）
  const addItems = [];
  let addSubTotal = 0;
  for(const k of Object.keys(heads)){
    const n = heads[k];
    if(n<=0) continue;

    const addUnit = svc.plan[k][1];
    const reduce = (k===baseKey) ? 1 : 0;
    const addN = Math.max(0, n - reduce);
    if(addN>0){
      const sub = addUnit * addN * v;
      addSubTotal += sub;
      addItems.push({k, addN, addUnit, sub});
    }
  }

  const planTotal = baseSub + addSubTotal; // 回数分のプラン合計

  // ===== 割増・割引（プランのみ）=====
  const busyAdd = busy.checked ? planTotal * MASTER.busy : 0;
  const afterHoursAdd = afterHours.checked ? planTotal * MASTER.afterHours : 0;
  const planAfterSurcharges = planTotal + busyAdd + afterHoursAdd;
  // レビュー割引は「基本プラン（メイン+ペット追加）」のみに適用（割増にはかけない）
  const reviewDiscount = review.checked ? planTotal * MASTER.review : 0;

  const planFinal = planAfterSurcharges - reviewDiscount;

  // ===== その他 =====
  const dispatchTotal = MASTER.dispatch * v;

  const extCount = +ext.value; // 0-4
  const extTotal = extCount>0 ? svc.ext * extCount * v : 0;

  const parkCounsel = parkingValue("parkingCounselSel","parkingCounselOther");
  const parkVisit = parkingValue("parkingVisitSel","parkingVisitOther");

  // カウンセリング時：チェックがONのときだけ、1回ぶん加算
  const parkingCounselTotal = (counseling.checked && parkCounsel>0) ? parkCounsel : 0;

  // シッティング時：回数ぶん加算
  const parkingVisitTotal = parkVisit>0 ? parkVisit * v : 0;

  const key = +keyReturn.value || 0; // 0/500/800（1回だけ）
  const keyTotal = key>0 ? key : 0;

  const grandTotal = planFinal + dispatchTotal + extTotal + parkingCounselTotal + parkingVisitTotal + keyTotal + counselingTotal;

  // ===== 表（お見積り）作成 =====
  if(counselingTotal>0){
    addSection("初回カウンセリング");
    addItem("初回カウンセリング費", num(MASTER.counseling), "1", num(MASTER.counseling));
    if(parkingCounselTotal>0){
      addItem("駐車場（初回）", num(parkCounsel), "1", num(parkingCounselTotal));
    }
  }

  addSection("プラン");
  addItem(`メイン：${NAME[baseKey]}（1頭目）`, num(basePrice), String(v), num(baseSub));

  // ペット追加（別種 + メインの2頭目以降）
  addItems.forEach(({k, addN, addUnit, sub})=>{
    addItem(`追加：${NAME[k]}（${addN}頭）`, num(addUnit), String(v), num(sub));
  });

  if(busyAdd>0) addItem("繁忙期（+20%）※プラン", "", "", `+${num(busyAdd)}`, "surcharge");
  if(afterHoursAdd>0) addItem("時間外（20:00-8:00 / +20%）※プラン", "", "", `+${num(afterHoursAdd)}`, "surcharge");
  if(reviewDiscount>0) addItem("レビュー割（-20%）※基本プラン", "", "", `-${num(reviewDiscount)}`, "discount");

  addItem("プラン小計", "", "", num(planFinal), "subtot");

  addSection("出張費");
  addItem("往復出張費", num(MASTER.dispatch), String(v), num(dispatchTotal));

  if(parkingVisitTotal>0){
    addItem("駐車場（シッティング）", num(parkVisit), String(v), num(parkingVisitTotal));
  }

  addSection("その他");
  if(extTotal>0){
    addItem(`時間延長（15分）`, num(svc.ext), String(extCount*v), num(extTotal));
  }
  if(keyTotal>0){
    const kLabel = (key===500) ? "こねこ便" : (key===800) ? "簡易書留" : "—";
    addItem(`鍵返却（${kLabel}）`, num(keyTotal), "1", num(keyTotal));
  }

  total.textContent = money(grandTotal);
  grandTotalCell.textContent = num(grandTotal);

  renderEstimate(rows, grandTotal);
  copyArea.textContent = buildCopyText(rows, grandTotal);
}

function renderEstimate(rows, grandTotal){
  const esc = (s)=> String(s).replace(/[&<>"']/g, c=>({ "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;" }[c]));
  estimateBody.innerHTML = rows.map(r=>{
    if(r.type==="section"){
      return `<tr class="section"><td colspan="4">${esc(r.title)}</td></tr>`;
    }
    const cls = r.cls ? ` ${r.cls}` : "";
    // muted row: message style (span all columns)
    if(r.cls==="muted-row"){
      return `<tr><td colspan="4" class="muted">${esc(r.item)}</td></tr>`;
    }
    return `<tr class="${esc(cls).trim()}">
      <td>${esc(r.item)}</td>
      <td class="num">${r.unit ?? ""}</td>
      <td class="num">${r.qty ?? ""}</td>
      <td class="num">${r.sub ?? ""}</td>
    </tr>`;
  }).join("");
}

function buildCopyText(rows, grandTotal){
  // Excelに貼れるタブ区切り（TSV）
  const lines = [];
  lines.push(["お見積り","単価","回数","小計"].join("\t"));
  rows.forEach(r=>{
    if(r.type==="section"){
      lines.push([`【${r.title}】`,"","",""].join("\t"));
      return;
    }
    if(r.cls==="muted-row"){
      lines.push([r.item,"","",""].join("\t"));
      return;
    }
    lines.push([r.item, r.unit||"", r.qty||"", r.sub||""].join("\t"));
  });
  lines.push(["合計金額（税込）","","", String(grandTotal).includes("¥") ? grandTotal : Math.round(grandTotal).toLocaleString("ja-JP")].join("\t"));
  return lines.join("\n");
}

function copyResult(){
  const text = copyArea.textContent.trim();
  if(!text){
    alert("コピーする内容がありません");
    return;
  }
  navigator.clipboard.writeText(text);
  alert("コピーしました");
}




enableAutoCalc();
calc();
</script>
</body>
</html>
